#!/bin/bash

if [ ! -d "var" ]; then
    mkdir var
fi

if [ ! -p "var/log" ]; then
    mkfifo var/log
    chmod go+rw var/log
fi

if [ ! -p "var/telemetry" ]; then
    mkfifo var/telemetry
    chmod go+rw var/telemetry
fi

tail -f -c+1 var/log&

if [ "$BASIS_ENVIRONMENT" != "dev" ]; then
    ./composer.phar dump-autoload --classmap-authoritative
else
    ./composer.phar dump-autoload
fi

php console module.starter&

apache2-foreground > /dev/null